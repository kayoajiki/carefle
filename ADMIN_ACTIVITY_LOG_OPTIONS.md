# 管理画面：アクティビティログ記録範囲の選択肢

## オプションA: 最小限（必須のみ）

### 記録する操作
1. **認証**
   - ログイン（日時、IPアドレス、ユーザーエージェント）
   - ログアウト（日時）

2. **主要なデータ作成**
   - ユーザー登録
   - 診断完了
   - 初回日記作成
   - WCMシート作成完了
   - 持ち味レポ生成

### 記録しない操作
- データの更新・削除
- ページアクセス
- 設定変更
- 途中保存（下書き）

---

## オプションB: 包括的（すべての操作）

### 記録する操作
1. **認証**
   - ログイン、ログアウト（詳細情報含む）

2. **すべてのCRUD操作**
   - 診断: 作成、更新、削除、完了
   - 日記: 作成、更新、削除
   - 自己診断: 作成、更新、削除
   - WCM: 作成、更新、削除
   - 人生史: 作成、更新、削除
   - キャリアマイルストーン: 作成、更新、削除
   - 職務経歴書: アップロード、更新、削除
   - 履歴書: アップロード、更新、削除

3. **設定変更**
   - プロフィール更新
   - パスワード変更
   - 表示設定変更

4. **ページアクセス**
   - 主要ページへのアクセス（ダッシュボード、診断、日記など）

5. **AI生成操作**
   - 持ち味レポ生成
   - コンテキスト別取説生成
   - AIチャット送信

### 記録しない操作
- なし（すべて記録）

---

## オプションC: バランス型（推奨・中間案）

### 記録する操作

#### 1. 認証（必須）
- ✅ ログイン（日時、IPアドレス、ユーザーエージェント、成功/失敗）
- ✅ ログアウト（日時）
- ✅ パスワードリセット要求
- ✅ パスワードリセット完了

#### 2. ユーザーライフサイクル（重要）
- ✅ ユーザー登録
- ✅ プロフィール完了
- ✅ メール認証完了

#### 3. 主要なデータ作成（完了時のみ）
- ✅ 診断完了（診断ID、完了日時）
- ✅ 初回日記作成（日記ID、日付）
- ✅ 自己診断入力完了（診断タイプ、完了日時）
- ✅ WCMシート作成完了（シートID、完了日時）
- ✅ 人生史イベント作成（イベント数、作成日時）
- ✅ キャリアマイルストーン作成（マイルストーンID、作成日時）

#### 4. 重要なマイルストーン達成
- ✅ 7日間日記記録完了
- ✅ 持ち味レポ生成（生成日時）
- ✅ コンテキスト別取説生成（コンテキスト、生成日時）
- ✅ マッピング進捗完了（セクション、完了日時）

#### 5. データ削除（セキュリティ上重要）
- ✅ 診断削除（診断ID、削除日時）
- ✅ 日記削除（日記ID、日付、削除日時）
- ✅ 自己診断削除（診断ID、削除日時）
- ✅ WCMシート削除（シートID、削除日時）
- ✅ ユーザーアカウント削除

#### 6. ファイルアップロード（容量管理のため）
- ✅ 職務経歴書アップロード（ファイル名、サイズ、アップロード日時）
- ✅ 履歴書アップロード（ファイル名、サイズ、アップロード日時）
- ✅ 目標画像アップロード（ファイル名、サイズ、アップロード日時）

### 記録しない操作

#### 1. データ更新（頻度が高すぎる）
- ❌ 日記更新（作成のみ記録）
- ❌ 診断途中保存（完了時のみ記録）
- ❌ 設定変更（プロフィール、表示設定など）

#### 2. ページアクセス（ログが膨大になる）
- ❌ ダッシュボードアクセス
- ❌ 各機能ページへのアクセス
- ❌ 設定ページへのアクセス

#### 3. 閲覧操作（プライバシー保護）
- ❌ 持ち味レポ閲覧
- ❌ 診断結果閲覧
- ❌ 日記閲覧

#### 4. 軽微な操作
- ❌ AIチャット送信（個別メッセージは記録しない）
- ❌ 表示モード変更
- ❌ フィルター・ソート操作

---

## 推奨：オプションC（バランス型）の理由

### メリット
1. **管理しやすい量**: 重要な操作のみ記録するため、ログが膨大にならない
2. **セキュリティ**: 削除操作を記録することで、不正なデータ削除を追跡可能
3. **ユーザー行動分析**: 主要なマイルストーンを記録することで、ユーザーの進捗を把握可能
4. **パフォーマンス**: 記録頻度が適切なため、データベースへの負荷が少ない
5. **プライバシー**: 閲覧操作を記録しないことで、ユーザーのプライバシーを保護

### 記録される情報の例

```
ユーザーID: 123
アクション: 診断完了
対象: 診断ID 456
日時: 2025-12-17 14:30:00
IPアドレス: 192.168.1.1
ユーザーエージェント: Mozilla/5.0...
```

```
ユーザーID: 123
アクション: 日記作成
対象: 日記ID 789（日付: 2025-12-17）
日時: 2025-12-17 20:15:00
```

```
ユーザーID: 123
アクション: 持ち味レポ生成
対象: 持ち味レポID 101
日時: 2025-12-17 21:00:00
```

---

## アクティブユーザーの定義

### 日次アクティブユーザー（DAU）
- 過去24時間以内にログインしたユーザー
- または、過去24時間以内に何らかの操作（日記作成、診断完了など）を行ったユーザー

### 週次アクティブユーザー（WAU）
- 過去7日間以内にログインしたユーザー
- または、過去7日間以内に何らかの操作を行ったユーザー

### 月次アクティブユーザー（MAU）
- 過去30日間以内にログインしたユーザー
- または、過去30日間以内に何らかの操作を行ったユーザー

---

## 管理画面で表示する情報

### ダッシュボード
- アクティブユーザー数（DAU、WAU、MAU）
- 新規登録ユーザー数（今日、今週、今月）
- 主要操作の統計（診断完了数、日記作成数など）
- 最近のアクティビティ（最新20件）

### ユーザー一覧
- ユーザー基本情報（名前、メール、登録日）
- 最終ログイン日時
- 最終アクティビティ日時
- オンボーディング進捗状況
- アクション（詳細表示、編集、削除）

### ユーザー詳細
- 基本情報
- ログイン履歴（最新50件）
- アクティビティログ（最新100件）
- 作成したデータ一覧（診断、日記、WCMなど）
- オンボーディング進捗詳細

### アクティビティログ
- 全ユーザーのアクティビティログ（フィルター可能）
- 日付範囲で絞り込み
- ユーザーで絞り込み
- アクションタイプで絞り込み
- CSVエクスポート機能






