# キャリフレブラッシュアップ実装計画

## 実装済み機能 ✅

### 1. ゴールイメージの言語化機能（優先度：高）✅
- **実装状況**: 完了
- **内容**: 3-4行程度の簡潔なゴールイメージを保存・表示
- **実装内容**:
  - `users`テーブルに`goal_image`カラムを追加
  - 日記作成画面・マイルストーン設定画面に常時表示
  - 未来に7割、価値観などに3割の割合で表示
  - テキスト/図式（nanobanana pro API）の表示モード切り替え
  - ゴールイメージの編集機能

### 4. 振り返りと目標・目的の接続機能（優先度：高）✅
- **実装状況**: 完了
- **内容**: 日記や内省チャットの内容を、マイルストーンやWCMシートのWillと自動的に接続・可視化
- **実装内容**:
  - `GoalConnectionService`: AIによる関連性判定
  - `diary_goal_connections`テーブル: 接続情報を保存
  - 接続度（0-100）と理由を表示
  - 日記保存時に自動検出・表示

---

## 追加すべき機能

### 2. AIによる目標生成・未来像レコメンド機能（優先度：高）
- **内容**: 過去の情報（診断結果、人生史、日記）と現在の診断結果をインプットとして、AIが未来像や選択肢をレコメンド
- **目的**: 目標やありたい姿の言語化を支援
- **実装方針**:
  - 新規サービス: `GoalRecommendationService`（既存の`GoalRecommendationService`を拡張）
  - インプット: 現職満足度診断、自己診断結果、人生史、WCMシート、日記の蓄積
  - アウトプット: 3-5個の未来像候補（各3-4行）
  - **注意**: 既に`GoalRecommendationService`は存在し、ゴールイメージ生成機能を実装済み。この機能を拡張する形で実装

### 3. Will-Can-Mustシートの自動生成機能（優先度：中）
- **内容**: 診断結果や日記内容からAIがWCMシートを自動生成
- **目的**: 入力負担を軽減し、思考の手助けとしてAIを活用
- **実装方針**:
  - `WcmForm`に「AIで自動生成」ボタンを追加
  - `WcmAutoGenerationService`を作成
  - 生成後は手動で編集可能

### 5. キャリアコンパス（言語化版）（優先度：中）
- **内容**: 4項目（現職満足度診断、人生史、Will-Can-Must、自己診断結果）を埋めることで、1枚のシートとして統合表示
- **目的**: 過去・現在・未来の時間軸を含む統合ビューを提供
- **実装方針**:
  - ビジュアル化は後回し、まずは言語化された統合シート
  - `CareerCompassService`を作成し、各情報を統合して表示
  - 日記作成時やマイルストーン設定時に表示

### 6. ボトムアップ型改善点提案機能（優先度：中）
- **内容**: 現在の状態（診断結果、日記のモチベーション推移など）から改善点を提案
- **目的**: トップダウン（目標から）とボトムアップ（現状から）の両方を可能にする
- **実装方針**:
  - `ImprovementSuggestionService`を作成
  - モチベーション低下時や診断結果の偏りを検知して提案

### 7. 時間軸統合ビュー（ストック情報へのアクセス）（優先度：中）
- **内容**: 過去・現在・未来の情報を時間軸で統合表示
- **目的**: フローではなくストック情報に触れられるようにする
- **実装方針**:
  - タイムラインビューを拡張
  - 過去の出来事、現在の診断、未来の目標を1つの画面で表示

---

## 修正すべき機能

### 1. AIによる目標レコメンド機能（ActionPlanGeneratorService）（優先度：高）
- **現状**: 5-10個のアクションを提案（情報量が多い可能性）
- **修正内容**:
  - 提案数を3-5個に調整
  - ユーザー設定で表示数を変更可能に
  - 優先度の高いものから順に表示し、残りは「もっと見る」で展開

### 2. アクションアイテム提案機能（ActionItemGeneratorService）（優先度：中）
- **現状**: 日記から1-3個のアクションアイテムを提案
- **修正内容**:
  - 提案の精度向上（キーワードマッチングからAIベースの関連性判定へ）
  - 提案タイミングの最適化（毎回ではなく、関連性が高い場合のみ）

### 3. ビジュアライゼーション機能（優先度：低）
- **現状**: マイルストーン進捗、成長実感の可視化が実装済み
- **修正内容**:
  - 複雑なビジュアル化は後回し
  - 言語化された情報を優先的に表示
  - 既存の可視化は維持しつつ、言語説明を強化

---

## 削除・最適化すべき機能

### 情報過多による負担を軽減
- **現状**: 複数の機能から同時に多くの情報が表示される可能性
- **対応方針**: 削除ではなく、表示の最適化
  - ユーザー設定で表示項目をカスタマイズ可能に
  - デフォルトでは重要な情報のみ表示し、詳細は展開式に

---

## 実装優先順位

### Phase 1（最優先）✅
- ✅ ゴールイメージの言語化機能
- ✅ 振り返りと目標・目的の接続機能
- ⏳ AIによる目標レコメンド機能の調整（情報量削減）

### Phase 2（次優先）
- AIによる目標生成・未来像レコメンド機能
- Will-Can-Mustシートの自動生成機能

### Phase 3（中期的）
- キャリアコンパス（言語化版）
- ボトムアップ型改善点提案機能
- 時間軸統合ビュー

---

## 実装状況の確認

### 既存サービスの確認
- ✅ `GoalRecommendationService`: ゴールイメージ生成機能を実装済み
- ✅ `GoalConnectionService`: 日記とマイルストーン・WCMシートの接続機能を実装済み
- ✅ `ActionItemGeneratorService`: アクションアイテム提案機能を実装済み
- ✅ `ActionPlanGeneratorService`: 目標レコメンド機能を実装済み（調整が必要）

### 次の実装候補
1. **AIによる目標レコメンド機能の調整**（Phase 1）
2. **Will-Can-Mustシートの自動生成機能**（Phase 2）
3. **キャリアコンパス（言語化版）**（Phase 3）

---

## 備考

- ミニマンダラ機能は現状維持（削除しない）
- `will_theme`フィールドはマイルストーンのWillテーマとして使用中
- 内省チャットの構造化フローは実装済み

