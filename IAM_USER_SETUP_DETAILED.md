# IAMユーザー作成の詳細ガイド

## 概要

このガイドでは、AWS Bedrockを使用するためのIAMユーザーとアクセスキーの作成方法を、画面の流れに沿って詳しく説明します。

## 前提条件

- AWSアカウントを持っていること
- AWSコンソールにログインできること

## 詳細な手順

### ステップ1: AWSコンソールにログイン

1. ブラウザで https://console.aws.amazon.com/ を開く
2. AWSアカウントのメールアドレスとパスワードでログイン
3. 必要に応じて、MFA（多要素認証）のコードを入力

### ステップ2: IAMサービスに移動

**方法A: 検索から**
1. 画面上部の検索バー（「サービスを検索」と表示されている）をクリック
2. 「IAM」と入力
3. 検索結果から「IAM」をクリック

**方法B: 直接URL**
- https://console.aws.amazon.com/iam/ に直接アクセス

### ステップ3: ユーザー一覧ページに移動

1. 左側のメニューから「ユーザー」をクリック
2. 既存のユーザー一覧が表示されます（初めての場合は空）

### ステップ4: ユーザー追加を開始

1. 画面右上の青い「ユーザーを追加」ボタンをクリック
2. ユーザー作成ウィザードが開始されます

### ステップ5: ユーザー名を入力

1. **「ユーザー名」フィールド**
   - 任意のユーザー名を入力
   - 例: `carefle-bedrock-user`
   - 例: `bedrock-pdf-fix-user`
   - 注意: 大文字小文字、数字、記号（+ = , . @ _ -）が使用可能

2. **「AWS認証情報タイプを提供」セクション**
   - 「アクセスキー - プログラムによるアクセス」のチェックボックスにチェックを入れる
   - これにより、APIやCLI、SDKからアクセスできるようになります
   - 「コンソールへのアクセスを提供」はチェック不要（Webコンソールへのアクセスは不要）

3. **「次へ」ボタンをクリック**

### ステップ6: 権限を設定

1. **「既存のポリシーを直接アタッチ」タブを選択**
   - 3つのタブがあります：
     - 「ユーザーをグループに追加」（今回は使用しない）
     - **「既存のポリシーを直接アタッチ」** ← これを選択
     - 「ポリシーをコピー」（今回は使用しない）

2. **ポリシーを検索**
   - 検索バーに「Bedrock」と入力
   - または「AmazonBedrockFullAccess」と直接入力

3. **ポリシーを選択**
   - `AmazonBedrockFullAccess` の左側のチェックボックスにチェックを入れる
   - このポリシーには以下の権限が含まれます：
     ```
     - bedrock:InvokeModel
     - bedrock:InvokeModelWithResponseStream
     - bedrock:ListFoundationModels
     - bedrock:GetFoundationModel
     - aws-marketplace:Subscribe（初回使用時）
     ```

4. **「次へ」ボタンをクリック**

### ステップ7: タグの追加（オプション）

1. **タグは任意です**
   - タグはユーザーを管理するためのラベルです
   - 例: `Key: Purpose`, `Value: PDF文字化け修正`
   - スキップしても問題ありません

2. **「次へ」ボタンをクリック**

### ステップ8: 確認と作成

1. **設定内容を確認**
   - ユーザー名
   - アクセスの種類（プログラムによるアクセス）
   - アタッチされたポリシー（AmazonBedrockFullAccess）

2. **「ユーザーの作成」ボタンをクリック**

### ステップ9: アクセスキーを取得（最重要！）

1. **成功画面が表示されます**
   - 「ユーザーが正常に作成されました」というメッセージが表示されます

2. **アクセスキーIDをコピー**
   - 「アクセスキーID」の横に表示されている文字列をコピー
   - 形式: `AKIA` で始まる20文字の文字列
   - 例: `AKIAIOSFODNN7EXAMPLE`

3. **シークレットアクセスキーを表示・コピー**
   - 「シークレットアクセスキーを表示」ボタンをクリック
   - 表示された文字列をコピー
   - 形式: 40文字のランダムな文字列
   - 例: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`
   
   ⚠️ **超重要**: 
   - この画面を閉じると、シークレットアクセスキーは**二度と表示されません**
   - 必ずこの時点でコピーして、安全な場所に保存してください
   - 後で再取得することはできません

4. **CSVファイルをダウンロード（推奨）**
   - 「.csvのダウンロード」ボタンをクリック
   - CSVファイルがダウンロードされます
   - このファイルにはアクセスキーIDとシークレットアクセスキーが含まれています
   - 安全な場所（パスワードマネージャーなど）に保存してください

5. **「完了」ボタンをクリック**

### ステップ10: .envファイルに設定

1. プロジェクトの`.env`ファイルを開く

2. 以下のように設定を追加：

```env
# AWS認証情報
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_DEFAULT_REGION=us-east-1

# Bedrock設定
AWS_BEDROCK_REGION=us-east-1
AWS_BEDROCK_MODEL_ID=anthropic.claude-3-5-sonnet-20241022-v2:0
AWS_BEDROCK_FIX_GARBLED_TEXT=true
```

3. 実際のアクセスキーIDとシークレットアクセスキーに置き換えてください

## セキュリティチェックリスト

- [ ] アクセスキーを安全な場所に保存した
- [ ] `.env`ファイルが`.gitignore`に含まれていることを確認した
- [ ] アクセスキーをGitHubやその他の公開リポジトリにコミットしていない
- [ ] アクセスキーをメールやチャットで送信していない
- [ ] 必要に応じて、パスワードマネージャーに保存した

## トラブルシューティング

### 「ユーザーを追加」ボタンが見つからない

- IAMへのアクセス権限があるか確認してください
- ルートアカウントでログインしているか確認してください

### ポリシーが見つからない

- 検索バーに「Bedrock」と入力してください
- 大文字小文字は区別されません
- ポリシー名の一部でも検索できます

### アクセスキーを失くしてしまった

- シークレットアクセスキーは再取得できません
- 新しいアクセスキーを作成する必要があります：
  1. ユーザーを選択
  2. 「セキュリティ認証情報」タブ
  3. 「アクセスキーの作成」ボタン
  4. 古いアクセスキーは削除することを推奨

## 次のステップ

アクセスキーを取得したら：
1. `.env`ファイルに設定
2. 職務経歴書をアップロードして動作確認
3. 文字化けが検出された場合、自動的にBedrockで修正されます

