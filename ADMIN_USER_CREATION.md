# 管理者ユーザーの作成方法

## 概要

本番環境で管理者権限を持つユーザーを作成・管理するためのコマンドです。

## コマンド

```bash
php artisan admin:create-user
```

## 使用方法

### 1. インタラクティブモード（推奨）

```bash
php artisan admin:create-user
```

実行すると、以下の情報を対話形式で入力できます：
- メールアドレス
- ユーザー名
- パスワード（8文字以上）
- パスワード確認

### 2. オプション付き実行

```bash
php artisan admin:create-user admin@example.com --name="管理者" --password="your-secure-password"
```

#### オプション
- `email`（位置引数）: 管理者のメールアドレス
- `--name`: ユーザー名
- `--password`: パスワード（8文字以上）

### 3. 既存ユーザーに管理者権限を付与

既にアカウントが存在するユーザーに管理者権限を付与する場合：

```bash
php artisan admin:create-user existing-user@example.com
```

既存ユーザーの場合、管理者権限を付与するかどうか確認されます。

## 本番環境での実行手順

### ステップ1: 本番サーバーにSSH接続

```bash
ssh user@your-production-server
```

### ステップ2: プロジェクトディレクトリに移動

```bash
cd /path/to/carefle
```

### ステップ3: コマンドを実行

```bash
php artisan admin:create-user
```

### ステップ4: 情報を入力

プロンプトに従って以下を入力：
1. **メールアドレス**: 管理者用のメールアドレス
2. **ユーザー名**: 表示名
3. **パスワード**: 8文字以上の安全なパスワード
4. **パスワード確認**: パスワードを再入力

### ステップ5: 作成完了の確認

成功すると以下の情報が表示されます：
```
✓ 管理者ユーザーを作成しました！

+------------------+-------------------------+
| 項目             | 値                      |
+------------------+-------------------------+
| ID               | 1                       |
| 名前             | 管理者                  |
| メールアドレス   | admin@example.com       |
| 管理者権限       | はい                    |
| 作成日時         | 2025-12-19 12:00:00     |
+------------------+-------------------------+
```

## セキュリティ上の注意

1. **強力なパスワードを使用**
   - 最低8文字以上
   - 大文字・小文字・数字・記号を組み合わせる
   - 推測されやすい単語は避ける

2. **管理者メールアドレスの管理**
   - 業務用のメールアドレスを使用
   - 共有アドレスは避ける
   - 定期的にアクセスログを確認

3. **本番環境での実行記録**
   - 管理者ユーザー作成の記録を残す
   - 誰が、いつ、どのアカウントを作成したか記録

## トラブルシューティング

### エラー: 無効なメールアドレス
- 正しいメールアドレス形式で入力してください（例: user@example.com）

### エラー: パスワードが一致しません
- パスワードとパスワード確認が一致していることを確認してください

### エラー: パスワードは8文字以上である必要があります
- より長いパスワードを設定してください

### エラー: このメールアドレスは既に管理者として登録されています
- 既に管理者として登録済みです。別のメールアドレスを使用してください

## 管理者権限の確認

作成した管理者アカウントでログイン後、サイドバーに「管理」セクションが表示されることを確認してください。

管理画面からアクセスできる機能：
- 管理ダッシュボード (`/admin/dashboard`)
- ユーザー管理 (`/admin/users`)
- プロフィール統計 (`/admin/profile-stats`)
- アクティビティログ (`/admin/activity-logs`)

## データベースから直接確認（上級者向け）

```bash
# Tinkerを起動
php artisan tinker

# 管理者ユーザーを確認
User::where('is_admin', true)->get(['id', 'name', 'email', 'is_admin']);

# 特定のユーザーが管理者か確認
User::where('email', 'admin@example.com')->value('is_admin');
```

## 管理者権限の削除

管理者権限を削除する場合は、Tinkerまたは管理画面から実行できます：

```bash
php artisan tinker

# 管理者権限を削除
$user = User::where('email', 'user@example.com')->first();
$user->is_admin = false;
$user->save();
```

---

**最終更新日**: 2025年12月19日

