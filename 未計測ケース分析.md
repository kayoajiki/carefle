# 01・02が「未計測」になるケースの分析

## 現在のロジックの流れ

1. **満足度と重要度の差分計算**（16-36行目）
   - 各pillarで `満足度 - 重要度` を計算
   - `diff > 0` の場合：強み（02）候補
   - `diff < 0` の場合：伸ばしどころ（01）候補

2. **強みのフォールバック処理**（38-56行目）
   - 強みが見つからない場合、満足度の中で一番高い項目を選ぶ

3. **ラベル取得**（58-60行目）
   - `$weakestKey` または `$strongestKey` が `null` の場合、「未計測」

4. **最終フォールバック**（62-70行目）
   - 両方とも「未計測」の場合、`$radarWorkData` から最小値・最大値を取得

---

## 01（フォーカス領域）が「未計測」になるケース

### ケース1: すべてのpillarで満足度 >= 重要度
**条件**:
- すべてのpillarで `$pillarWorkScore !== null && $importanceScore !== null`
- かつ、すべてのpillarで `$diff >= 0`（満足度が重要度以上）

**原因**:
- 重要度が満足度より高いpillarが存在しない
- つまり、すべての領域で満足度が重要度以上

**フォールバックでの解決可能性**:
- `$radarWorkData` にデータがあれば、最小値のpillarが選ばれる可能性あり

---

### ケース2: 満足度と重要度の両方が存在するpillarが1つもない
**条件**:
- すべてのpillarで `$pillarWorkScore === null` または `$importanceScore === null`

**原因**:
- `$workPillarScores` が空または不完全
- `$importanceWork` が空または不完全
- または、pillarのキーが一致していない

**フォールバックでの解決可能性**:
- `$radarWorkData` にデータがあれば、最小値のpillarが選ばれる可能性あり

---

### ケース3: 重要度データが存在しない
**条件**:
- `$importanceWork` が空またはすべて `null`
- 満足度データは存在する

**原因**:
- 重要度診断を実施していない
- 重要度回答が保存されていない

**フォールバックでの解決可能性**:
- `$radarWorkData` にデータがあれば、最小値のpillarが選ばれる可能性あり

---

### ケース4: 満足度データが存在しない
**条件**:
- `$workPillarScores` が空またはすべて `null`
- 重要度データは存在する

**原因**:
- 満足度診断を実施していない
- 満足度回答が保存されていない
- `work_pillar_scores` が正しく計算・保存されていない

**フォールバックでの解決可能性**:
- `$radarWorkData` が空の場合は解決不可

---

### ケース5: フォールバックでも解決できない
**条件**:
- `$radarWorkData` が空またはすべて `null`
- または、`$minScore` が `null`

**原因**:
- 満足度データが完全に存在しない
- レーダーチャート用データの準備に問題がある

---

## 02（活かしたい強み）が「未計測」になるケース

### ケース1: すべてのpillarで満足度 <= 重要度
**条件**:
- すべてのpillarで `$pillarWorkScore !== null && $importanceScore !== null`
- かつ、すべてのpillarで `$diff <= 0`（満足度が重要度以下）

**原因**:
- 満足度が重要度より高いpillarが存在しない
- フォールバック処理（38-56行目）で満足度の最大値を選ぶが、それでも `null` の場合

**フォールバックでの解決可能性**:
- 満足度データがあれば、最大値のpillarが選ばれる（38-56行目の処理）
- それでも解決しない場合は、満足度データが存在しない

---

### ケース2: 満足度データが存在しない
**条件**:
- `$workPillarScores` が空またはすべて `null`

**原因**:
- 満足度診断を実施していない
- 満足度回答が保存されていない
- `work_pillar_scores` が正しく計算・保存されていない

**フォールバックでの解決可能性**:
- `$radarWorkData` にデータがあれば、最大値のpillarが選ばれる可能性あり

---

### ケース3: フォールバックでも解決できない
**条件**:
- `$radarWorkData` が空またはすべて `null`
- または、`$maxScore` が `null`

**原因**:
- 満足度データが完全に存在しない
- レーダーチャート用データの準備に問題がある

---

## 両方が「未計測」になるケース

### ケース1: 満足度データが完全に存在しない
**条件**:
- `$workPillarScores` が空
- `$radarWorkData` が空またはすべて `null`

**原因**:
- 満足度診断を実施していない
- 満足度回答が保存されていない
- `work_pillar_scores` が正しく計算・保存されていない

---

### ケース2: データの不整合
**条件**:
- `$workPillarScores` と `$radarWorkData` のキーが一致していない
- pillarのキーが `$pillarLabels` と一致していない

**原因**:
- データベースのデータ構造の問題
- 計算ロジックの変更による不整合

---

## 診断を実施しても発生する可能性があるケース（要改善）

### 1. 重要度を回答していない場合
- **現状**: 01が「未計測」になる可能性が高い
- **理由**: `$importanceWork` が空のため、差分計算ができない
- **改善案**: 重要度がなくても、満足度データだけで01・02を決定できるようにする

### 2. すべてのpillarで満足度 = 重要度の場合
- **現状**: 01が「未計測」になる可能性がある
- **理由**: `diff < 0` のpillarが存在しない
- **改善案**: `diff = 0` の場合も考慮する、または満足度の最小値を選ぶ

### 3. すべてのpillarで満足度 < 重要度の場合
- **現状**: 02が「未計測」になる可能性がある（フォールバックで解決される可能性あり）
- **理由**: `diff > 0` のpillarが存在しない
- **改善案**: 既に実装済み（満足度の最大値を選ぶ）

### 4. すべてのpillarで満足度 > 重要度の場合
- **現状**: 01が「未計測」になる可能性がある
- **理由**: `diff < 0` のpillarが存在しない
- **改善案**: 重要度が満足度より高いpillarがない場合、満足度の最小値を選ぶ

---

## 推奨される改善策

1. **重要度がなくても動作するようにする**
   - 満足度データだけで01・02を決定
   - 01: 満足度が最小のpillar
   - 02: 満足度が最大のpillar

2. **すべてのケースで必ず01・02を表示する**
   - `diff = 0` の場合も考慮
   - フォールバック処理を強化

3. **データの整合性チェック**
   - `$workPillarScores` と `$radarWorkData` の整合性を確認
   - pillarのキーが一致しているか確認





